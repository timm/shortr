<!DOCTYPE html>

<html>
<head>
  <title>tmp314.lua</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>tmp314.lua</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span><span class="hljs-string">&quot;lib&quot;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <p>modules start with an Upper case letter
class methods are in Module.UPPERCASE (e.g. Module.NEW for constructors)
instance methods are in Module.method(i,…)
don’t say self, say “i” (shorter)
where p– osible, if looking at two instances, use “i,j”
types = int,real, str,tab</p>
<hr>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> the={ <span class="hljs-built_in">min</span>  = <span class="hljs-number">.5</span>,
            bins = <span class="hljs-number">16</span>,
            some = <span class="hljs-number">256</span>, 
            seed = <span class="hljs-number">10019</span>,
            file = <span class="hljs-string">&quot;../../../data/auto93.csv&quot;</span>}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> Col={}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.GOAL</span><span class="hljs-params">(x)</span></span>   <span class="hljs-keyword">return</span> (x <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>):<span class="hljs-built_in">find</span><span class="hljs-string">&quot;[!+-]$&quot;</span> <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.NUMP</span><span class="hljs-params">(x)</span></span>   <span class="hljs-keyword">return</span> (x <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>):<span class="hljs-built_in">find</span><span class="hljs-string">&quot;^[A-Z]&quot;</span> <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.KLASS</span><span class="hljs-params">(x)</span></span>  <span class="hljs-keyword">return</span> (x <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>):<span class="hljs-built_in">find</span><span class="hljs-string">&quot;!$&quot;</span>  <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.SKIP</span><span class="hljs-params">(x)</span></span>   <span class="hljs-keyword">return</span> (x <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>):<span class="hljs-built_in">find</span><span class="hljs-string">&quot;:$&quot;</span>  <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.WEIGHT</span><span class="hljs-params">(x)</span></span> <span class="hljs-keyword">return</span> (x <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>):<span class="hljs-built_in">find</span><span class="hljs-string">&quot;-$&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-number">-1</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p><strong>Col.COLS( <code>s</code>:  [str])  -&gt;   COLS</strong> <br>  constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.COLS</span><span class="hljs-params">(names)</span></span>
  <span class="hljs-keyword">local</span> i={x={}, y={}, names=names, klass=<span class="hljs-literal">nil</span>}
  <span class="hljs-keyword">for</span> at,txt <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(names) <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">local</span> new = Col.NUMP(txt) <span class="hljs-keyword">and</span> Col.NUM(at,txt) <span class="hljs-keyword">or</span> Col.NEW(at,txt)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> Col.SKIP(txt) <span class="hljs-keyword">then</span>
      push(Col.GOAL(txt) <span class="hljs-keyword">and</span> i.y <span class="hljs-keyword">or</span> i.x, new)
      <span class="hljs-keyword">if</span> Col.KLASS(txt) <span class="hljs-keyword">then</span> i.klass=new <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> i <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p><strong>Col.NEW( <code>t</code>:  ?int,  <code>t</code>:  ?str)  -&gt;   COL</strong> <br>  constructor of numbers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.NEW</span><span class="hljs-params">(at,txt)</span></span>
  <span class="hljs-keyword">return</span> {n  =<span class="hljs-number">0</span>,     at=at <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>, txt=txt <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>, 
          ok =<span class="hljs-literal">false</span>, kept={},
          div=<span class="hljs-number">0</span>,     mid=<span class="hljs-number">0</span>} <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.NUM</span><span class="hljs-params">(at,txt,some)</span></span>
   i     = Col.NEW(at,txt)
   i.w   = Col.WEIGHT(txt)
   i.nums= some <span class="hljs-keyword">or</span> the.some <span class="hljs-comment">-- if non-nil the i.nums is a numeric</span>
   <span class="hljs-keyword">return</span> i <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.add</span><span class="hljs-params">(i,v,inc)</span></span>
 inc = inc <span class="hljs-keyword">or</span> <span class="hljs-number">1</span>
 <span class="hljs-keyword">if</span>   v ~= <span class="hljs-string">&quot;?&quot;</span>
 <span class="hljs-keyword">then</span> i.n = i.n + inc
      <span class="hljs-keyword">if</span> i.nums 
      <span class="hljs-keyword">then</span> <span class="hljs-keyword">for</span> _=<span class="hljs-number">1</span>,inc <span class="hljs-keyword">do</span>
            <span class="hljs-keyword">if</span>     #i.kept &lt; i.nums <span class="hljs-keyword">then</span> i.ok=<span class="hljs-literal">false</span>;push(i.kept,v) 
            <span class="hljs-keyword">elseif</span> R() &lt; i.nums/i.n <span class="hljs-keyword">then</span> i.ok=<span class="hljs-literal">false</span>;i.kept[R(#i.kept)]=v <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> 
      <span class="hljs-keyword">else</span> i.ok = <span class="hljs-literal">false</span>
           i.kept[v] = inc + (i.kept[v] <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> i <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.ok</span><span class="hljs-params">(i)</span></span>
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> i.ok <span class="hljs-keyword">then</span> 
    i.div, i.mid = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>
    <span class="hljs-keyword">if</span>   i.nums 
    <span class="hljs-keyword">then</span> i.kept = <span class="hljs-built_in">sort</span>(i.kept)
         i.mid  = per(i.kept, <span class="hljs-number">.5</span>)
         i.div  = (per(i.kept, <span class="hljs-number">.9</span>) - per(i.kept, <span class="hljs-number">.1</span>)) / <span class="hljs-number">2.56</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">local</span> most = <span class="hljs-number">-1</span>
         <span class="hljs-keyword">for</span> x,n <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(i.kept) <span class="hljs-keyword">do</span> 
           <span class="hljs-keyword">if</span> n &gt; most <span class="hljs-keyword">then</span> most, i.mid = n, x <span class="hljs-keyword">end</span>
           i.div = i.div - n/i.n * <span class="hljs-built_in">math</span>.<span class="hljs-built_in">log</span>( n/i.n, <span class="hljs-number">2</span>) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> 
  i.ok = <span class="hljs-literal">true</span> <span class="hljs-keyword">end</span>
  
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.lo</span><span class="hljs-params">(i)</span></span>   Col.ok(i); <span class="hljs-keyword">return</span> i.kept[<span class="hljs-number">1</span>] <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.hi</span><span class="hljs-params">(i)</span></span>   Col.ok(i); <span class="hljs-keyword">return</span> i.kept[#i.kept] <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.div</span><span class="hljs-params">(i)</span></span>  Col.ok(i); <span class="hljs-keyword">return</span> i.div <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.mid</span><span class="hljs-params">(i)</span></span>  Col.ok(i); <span class="hljs-keyword">return</span> i.mid <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.norm</span><span class="hljs-params">(i,x)</span></span> 
  <span class="hljs-keyword">local</span> lo,hi = Col.lo(i), Col.hi(i)
  <span class="hljs-keyword">return</span> hi-lo &lt; <span class="hljs-number">1E-9</span> <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> (x-lo)/(hi-lo) <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col.bin</span><span class="hljs-params">(i,x)</span></span>
  <span class="hljs-keyword">if</span>   i.nums <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">local</span> lo,hi = Col.lo(i), Col.hi(i)
    <span class="hljs-keyword">local</span> b=(hi - lo)/the.bins
    x = lo==hi <span class="hljs-keyword">and</span> <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">math</span>.<span class="hljs-built_in">floor</span>(x/b+<span class="hljs-number">.5</span>)*b <span class="hljs-keyword">end</span> 
  <span class="hljs-keyword">return</span> x <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> Row={}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Row.NEW</span><span class="hljs-params">(of,cells)</span></span> <span class="hljs-keyword">return</span> {of=of,cells=cells,evaled=<span class="hljs-literal">false</span>} <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Row.better</span><span class="hljs-params">(i,j)</span></span>
  <span class="hljs-keyword">local</span> s1, s2, n = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, #i.of.y
  <span class="hljs-keyword">for</span> _,c <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(i.of.y) <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">local</span> x,y =  i.cells[c.at], j.cells[c.at]
    x,y = Col.norm(c, x), Col.norm(c, y)
    s1  = s1 - <span class="hljs-number">2.7183</span>^(c.w * (x-y)/n)
    s2  = s2 - <span class="hljs-number">2.7183</span>^(c.w * (y-x)/n) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> s1/n &lt; s2/n  <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> Data={}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Data.NEW</span><span class="hljs-params">(t)</span></span> <span class="hljs-keyword">return</span> {rows={}, cols=Col.COLS(t)} <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Data.ROWS</span><span class="hljs-params">(src,fun)</span></span>
  <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(src)==<span class="hljs-string">&quot;table&quot;</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">for</span>  _,t <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(src) <span class="hljs-keyword">do</span> fun(t) <span class="hljs-keyword">end</span>
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">for</span>    t <span class="hljs-keyword">in</span> csv(src)   <span class="hljs-keyword">do</span> fun(t) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> 

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Data.clone</span><span class="hljs-params">(i,inits,   j)</span></span>
  j=Data.NEW(i.names)
  <span class="hljs-keyword">for</span> _,t <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(inits <span class="hljs-keyword">or</span> {}) <span class="hljs-keyword">do</span> Data.add(j,t) <span class="hljs-keyword">end</span>; <span class="hljs-keyword">return</span> j <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Data.add</span><span class="hljs-params">(i,t)</span></span>
  t = t.cells <span class="hljs-keyword">and</span> t <span class="hljs-keyword">or</span> Row.NEW(i,t)
  push(i.rows, t)
  <span class="hljs-keyword">for</span> _,cols <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>{i.cols.x, i.cols.y} <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">for</span> _,c <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(cols) <span class="hljs-keyword">do</span> Col.add(c, t.cells[c.at]) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> 

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Data.mids</span><span class="hljs-params">(i,cols, t)</span></span> 
  t={}
  <span class="hljs-keyword">for</span> _,c <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(cols <span class="hljs-keyword">or</span> i.cols.y) <span class="hljs-keyword">do</span> t[c.txt] = Col.mid(c) <span class="hljs-keyword">end</span>;<span class="hljs-keyword">return</span> t <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> Bin={}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Bin.new</span><span class="hljs-params">(xlo, xhi, ys)</span></span> <span class="hljs-keyword">return</span> {lo=xlo, hi=yhi, ys-ys} <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Bin.add</span><span class="hljs-params">(i,x,y)</span></span>
  i.lo = <span class="hljs-built_in">math</span>.<span class="hljs-built_in">min</span>(i.lo, x)
  i.hi = <span class="hljs-built_in">math</span>.<span class="hljs-built_in">max</span>(i.hi, x)
  Col.add(i.ys, y) <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Bin.merge</span><span class="hljs-params">(i,j, min)</span></span>
  <span class="hljs-keyword">local</span> k = Col.NEW(i.at, i.txt)
  <span class="hljs-keyword">for</span> x,n <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(i.ys.kept) <span class="hljs-keyword">do</span> Col.add(k,x,n) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">for</span> x,n <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(j.ys.kept) <span class="hljs-keyword">do</span> Col.add(k,x,n) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">if</span> i.n&lt;<span class="hljs-built_in">min</span> <span class="hljs-keyword">or</span> j.n&lt;<span class="hljs-built_in">min</span> <span class="hljs-keyword">or</span> Col.div(k) &lt;= (i.n*Col.div(i) + j.n*Col.div(j)) / k.n 
  <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> {lo=i.lo, hi=j.hi, ys=k} <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Bin.BINS</span><span class="hljs-params">(listOfRows,col,y)</span></span>
  <span class="hljs-keyword">local</span> n,list, dict = <span class="hljs-number">0</span>,{}, {}
  <span class="hljs-keyword">for</span> label,rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(listOfRows) <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">for</span> _,row <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(rows) <span class="hljs-keyword">do</span>
      <span class="hljs-keyword">local</span> v = row[col.at]
      <span class="hljs-keyword">if</span> v ~= <span class="hljs-string">&quot;?&quot;</span> <span class="hljs-keyword">then</span>
        n = n + <span class="hljs-number">1</span>
        <span class="hljs-keyword">local</span> pos = Col.bin(col,v)
        dict[pos] = dict[pos] <span class="hljs-keyword">or</span> push(list, Bin.new(v,v,Col.new(col.at,col.txt)))
        Bin.add(dict[pos], v, label) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>
    list = <span class="hljs-built_in">sort</span>(list, lt<span class="hljs-string">&quot;lo&quot;</span>)
    list = col.nums <span class="hljs-keyword">and</span> Bin.MERGES(list, n^the.<span class="hljs-built_in">min</span>) <span class="hljs-keyword">or</span> list
    <span class="hljs-keyword">return</span> {bins= list,
            div = sum(list,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(z)</span></span> <span class="hljs-keyword">return</span> Col.div(z.ys)*z.ys.n/n <span class="hljs-keyword">end</span>)} <span class="hljs-keyword">end</span>
 
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Bin.MERGES</span><span class="hljs-params">(b4, min)</span></span>
  <span class="hljs-keyword">local</span> j,now = <span class="hljs-number">1</span>,{}
  <span class="hljs-keyword">while</span> j &lt;= #b4 <span class="hljs-keyword">do</span> 
    <span class="hljs-keyword">local</span> merged = j&lt;#b4 <span class="hljs-keyword">and</span> Bin.merge(b4[j], b4[j+<span class="hljs-number">1</span>], <span class="hljs-built_in">min</span>)
    now[#now+<span class="hljs-number">1</span>]  = merged <span class="hljs-keyword">or</span> b4[j] 
    j            = j + (merged <span class="hljs-keyword">and</span> <span class="hljs-number">2</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span>)  <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">if</span>   #now &lt; #b4 
  <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> Bin.MERGES(now,<span class="hljs-built_in">min</span>) <span class="hljs-comment">-- loop to look for other merges</span>
  <span class="hljs-keyword">else</span> <span class="hljs-comment">-- stretch the bins to cover minus infinity to plus Infinity</span>
       <span class="hljs-keyword">for</span> j=<span class="hljs-number">2</span>,#now <span class="hljs-keyword">do</span> now[j].lo = now[j<span class="hljs-number">-1</span>].hi <span class="hljs-keyword">end</span>
       now[<span class="hljs-number">1</span>].lo, now[#now].hi = -big, big
       <span class="hljs-keyword">return</span> now <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>Go,No = {},{}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Go.THE</span><span class="hljs-params">()</span></span> oo(the) <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Go.ROWS</span><span class="hljs-params">(  d)</span></span> 
  Data.ROWS(the.file,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(row)</span></span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> d <span class="hljs-keyword">then</span> d=Data.NEW(row) <span class="hljs-keyword">else</span>
       Data.add(d,row) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>)
  oo(Data.mids(d)) <span class="hljs-keyword">end</span> 

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Go.STATS</span><span class="hljs-params">()</span></span> 
  oo(summarize(rows(the.file) )) 
<span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Go.ORDER</span><span class="hljs-params">(  i,t)</span></span> 
  i= rows(the.file)
  t= orders(i, i.xy)
  left = clone(i,splice(i.xy,<span class="hljs-number">1</span>,<span class="hljs-number">30</span>))
  right= clone(i,splice(i.xy,<span class="hljs-number">360</span>))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;first&quot;</span>,o(mids(left)))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;last&quot;</span>, o(mids(right)))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;all&quot;</span>,  o(mids(i)))
  <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">math</span>.<span class="hljs-built_in">randomseed</span>(the.seed)
<span class="hljs-keyword">if</span> <span class="hljs-built_in">arg</span>[<span class="hljs-number">1</span>]==<span class="hljs-string">&quot;-g&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span>(Go[<span class="hljs-built_in">arg</span>[<span class="hljs-number">2</span>]])==<span class="hljs-string">&quot;function&quot;</span> <span class="hljs-keyword">then</span> Go[<span class="hljs-built_in">arg</span>[<span class="hljs-number">2</span>]]() <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
