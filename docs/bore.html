<!DOCTYPE html>

<html>
<head>
  <title>bore.lua</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>bore.lua</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <p> __<br>/\ \<br>\ \ ____    ___    _ __     __<br> \ \ ‘<strong><code>\  / __</code>\ /`‘__\ /‘__`\ 
  \ \ \L\ /\ \L\ \ \ / /\  <strong>/ 
   \ _,</strong>/\ _</strong><em>/ \ _\ \ _<em><strong><br>    /</strong></em>/  /</em>_<em>/   /</em>/  /____/</p>
<hr>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> help=<span class="hljs-string">[[

bore == best or rest
(c) 2022, Tim Menzies, BSD 2-clause license.

USAGE: 
  lua bore.lua [OPTIONS]

OPTIONS: 
  -Dump         stack dump on error = false
  -Format   S   format string        = %5.2f
  -best     F   best space           = .15
  -cohen    F   Cohen&#x27;s delta        = .35
  -data     N   data file            = etc/data/auto93.csv
  -furthest F   far                  = .9
  -help         show help            = false
  -seed     I   random seed          = 10019
  -todo     S   start-up action      = nothing
]]</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <hr>
<p> / <em>| _   _  _ __    ___ | |</em> (<em>)  ___   _ __   ___ 
| |</em> | | | || ‘_ \  / <strong>|| <em><em>|| | / _ \ | ‘</em> \ / <em><em>|
|  <em>|| |</em>| || | | || (</em>_ | |</em> | || (_) || | | |_</em> <br>|<em>|   _</em>,<em>||</em>| |_| _</strong>| _<em>||</em>| _<strong>/ |<em>| |</em>||_</strong>/</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> b4={}; <span class="hljs-keyword">for</span> k,_ <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(<span class="hljs-built_in">_ENV</span>) <span class="hljs-keyword">do</span> b4[k]=k <span class="hljs-keyword">end</span> 
<span class="hljs-keyword">local</span> big  = <span class="hljs-number">1E32</span>
<span class="hljs-keyword">local</span> tiny = <span class="hljs-number">1E-32</span>
<span class="hljs-keyword">local</span> the  = {}

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">atom</span><span class="hljs-params">(x)</span></span>   
  <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(x)~=<span class="hljs-string">&quot;string&quot;</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> x <span class="hljs-keyword">end</span>
  x = x:<span class="hljs-built_in">match</span><span class="hljs-string">&quot;^%s*(.-)%s*$&quot;</span> 
  <span class="hljs-keyword">if</span> x==<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">elseif</span> x==<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">tonumber</span>(x) <span class="hljs-keyword">or</span> x <span class="hljs-keyword">end</span>

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">atoms</span><span class="hljs-params">(x,  t)</span></span> 
  t={}; <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> x:<span class="hljs-built_in">gmatch</span>(sep <span class="hljs-keyword">or</span><span class="hljs-string">&quot;([^,]+)&quot;</span>) <span class="hljs-keyword">do</span> t[<span class="hljs-number">1</span>+#t]=atom(y) <span class="hljs-keyword">end</span>; <span class="hljs-keyword">return</span> t <span class="hljs-keyword">end</span>

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cli</span><span class="hljs-params">(txt,   t)</span></span>
  t={}
  txt:<span class="hljs-built_in">gsub</span>(<span class="hljs-string">&quot;\n  [-]([^%s]+)[^\n]*%s([^%s]+)&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key,x)</span></span>
    <span class="hljs-keyword">for</span> n,flag <span class="hljs-keyword">in</span> <span class="hljs-built_in">ipairs</span>(<span class="hljs-built_in">arg</span>) <span class="hljs-keyword">do</span> 
      <span class="hljs-keyword">if</span> flag:<span class="hljs-built_in">sub</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)==<span class="hljs-string">&quot;-&quot;</span> <span class="hljs-keyword">and</span> key:<span class="hljs-built_in">find</span>(<span class="hljs-string">&quot;^&quot;</span>..flag:<span class="hljs-built_in">sub</span>(<span class="hljs-number">2</span>)..<span class="hljs-string">&quot;.*&quot;</span>) <span class="hljs-keyword">then</span>
        x = x==<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">or</span> x==<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&quot;false&quot;</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">arg</span>[n+<span class="hljs-number">1</span>] <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> 
    t[key] = atom(x) <span class="hljs-keyword">end</span>)
  <span class="hljs-keyword">return</span> t <span class="hljs-keyword">end</span> 

<span class="hljs-keyword">local</span> fmt = <span class="hljs-built_in">string</span>.<span class="hljs-built_in">format</span>

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sort</span><span class="hljs-params">(t,f)</span></span> <span class="hljs-built_in">table</span>.<span class="hljs-built_in">sort</span>(t,f); <span class="hljs-keyword">return</span> t <span class="hljs-keyword">end</span>

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">slots</span><span class="hljs-params">(t, u)</span></span> 
  u={}; <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(t) <span class="hljs-keyword">do</span> <span class="hljs-keyword">if</span> k:<span class="hljs-built_in">sub</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)~=<span class="hljs-string">&quot;_&quot;</span> <span class="hljs-keyword">then</span> u[<span class="hljs-number">1</span>+#u]=k <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>; 
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">sort</span>(u) <span class="hljs-keyword">end</span>

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span><span class="hljs-params">(the, help, demos)</span></span>
  <span class="hljs-keyword">if</span> the.help <span class="hljs-keyword">then</span> <span class="hljs-built_in">print</span>(help) <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">for</span> _,todo <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(the.todo==<span class="hljs-string">&quot;all&quot;</span> <span class="hljs-keyword">and</span> slots(demos) <span class="hljs-keyword">or</span> {the.todo}) <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">math</span>.<span class="hljs-built_in">randomseed</span>(the.seed)
      <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(demos[todo])==<span class="hljs-string">&quot;function&quot;</span> <span class="hljs-keyword">then</span> demos[todo]() <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> 
  <span class="hljs-built_in">os</span>.<span class="hljs-built_in">exit</span>(demos.fails) <span class="hljs-keyword">end</span> 

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map</span><span class="hljs-params">(t,f, u)</span></span> 
  u={};<span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(t) <span class="hljs-keyword">do</span> u[<span class="hljs-number">1</span>+#u]=f(v) <span class="hljs-keyword">end</span>; <span class="hljs-keyword">return</span> u <span class="hljs-keyword">end</span>

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">o</span><span class="hljs-params">(t)</span></span>
  <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(t)~=<span class="hljs-string">&quot;table&quot;</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">tostring</span>(t) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">local</span> key=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(k)</span></span> <span class="hljs-keyword">return</span> fmt(<span class="hljs-string">&quot;:%s %s&quot;</span>,k,o(t[k])) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">local</span> u = #t&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">and</span> map(t,o) <span class="hljs-keyword">or</span> map(slots(t),key) 
  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;{&#x27;</span>..<span class="hljs-built_in">table</span>.<span class="hljs-built_in">concat</span>(u,<span class="hljs-string">&quot; &quot;</span>)..<span class="hljs-string">&quot;}&quot;</span> <span class="hljs-keyword">end</span> 

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">oo</span><span class="hljs-params">(t)</span></span> <span class="hljs-built_in">print</span>(o(t)) <span class="hljs-keyword">end</span>

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rows</span><span class="hljs-params">(file,      x,prep)</span></span>
  file = <span class="hljs-built_in">io</span>.<span class="hljs-built_in">input</span>(file)
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span> 
    x=<span class="hljs-built_in">io</span>.<span class="hljs-built_in">read</span>(); <span class="hljs-keyword">if</span> x <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> atoms(x) <span class="hljs-keyword">else</span> <span class="hljs-built_in">io</span>.<span class="hljs-built_in">close</span>(file) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <pre><code>   _                             
</code></pre>
<p>  ___ | |  __ _  ___  ___   ___  ___ 
 / <strong>|| | / <em>` |/ _<em>|/ _<em>| / _ / <strong>|
| (</strong> | || (</em>| |__ \_</em> |  <em><em>/_</em> <br> _</em><em>||</em>| __,</em>||__<em>/|</em></strong>/ _<strong>||</strong>_/</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">local</span> as=<span class="hljs-built_in">setmetatable</span>
<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">obj</span><span class="hljs-params">(   t)</span></span>
  t={<span class="hljs-built_in">__tostring</span>=o}; t.<span class="hljs-built_in">__index</span>=t
  <span class="hljs-keyword">return</span> as(t, {<span class="hljs-built_in">__call</span>=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_,...)</span></span> <span class="hljs-keyword">return</span> t.new(...) <span class="hljs-keyword">end</span>}) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <hr>
<p>|    |  | |<br>|___ |<strong>| |</strong>_ </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">col</span><span class="hljs-params">(at,x,  i)</span></span>
  i = {n=<span class="hljs-number">0</span>, at=at <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>, txt=txt <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>, has={}}
  i.w = i.txt:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;-$&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-number">-1</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span>
  <span class="hljs-keyword">return</span> i <span class="hljs-keyword">end</span>

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span><span class="hljs-params">(self,x,inc)</span></span>
  <span class="hljs-keyword">if</span> x~=<span class="hljs-string">&quot;?&quot;</span> <span class="hljs-keyword">then</span>
    inc = inc <span class="hljs-keyword">or</span> <span class="hljs-number">1</span>
    <span class="hljs-built_in">self</span>.n = <span class="hljs-built_in">self</span>.n+<span class="hljs-number">1</span>
    <span class="hljs-built_in">self</span>:add1(x,inc <span class="hljs-keyword">or</span> inc) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <hr>
<p>|\ | |  | |/| 
| | |__| |  | </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">local</span> Num=obj{}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Num:new</span><span class="hljs-params">(at,x,  new)</span></span>
  new = as(col(at,t),<span class="hljs-built_in">self</span>)
  new.mu, new.m2, new.lo, new.hi= <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,-big,big
  <span class="hljs-keyword">return</span> new <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Num:add1</span><span class="hljs-params">(self,x,_,    d)</span></span> 
  d = x - <span class="hljs-built_in">self</span>.mu
  <span class="hljs-built_in">self</span>.mu = <span class="hljs-built_in">self</span>.mu + d/<span class="hljs-built_in">self</span>.n
  <span class="hljs-built_in">self</span>.m2 = <span class="hljs-built_in">self</span>.m2 + d*(x - <span class="hljs-built_in">self</span>.mu)
  <span class="hljs-built_in">self</span>.sd = (<span class="hljs-built_in">self</span>.n&lt;<span class="hljs-number">2</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">self</span>.m2&lt;<span class="hljs-number">0</span>) <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> (<span class="hljs-built_in">self</span>.m2/(<span class="hljs-built_in">self</span>.n<span class="hljs-number">-1</span>))^<span class="hljs-number">.5</span> 
  <span class="hljs-keyword">if</span> x &gt; <span class="hljs-built_in">self</span>.<span class="hljs-built_in">max</span> <span class="hljs-keyword">then</span> <span class="hljs-built_in">self</span>.<span class="hljs-built_in">max</span> = x <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">if</span> x &lt; <span class="hljs-built_in">self</span>.<span class="hljs-built_in">min</span> <span class="hljs-keyword">then</span> <span class="hljs-built_in">self</span>.<span class="hljs-built_in">min</span> = x <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Num:norm</span><span class="hljs-params">(x)</span></span> 
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>.hi-<span class="hljs-built_in">self</span>.lo&lt;tiny <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> (x-<span class="hljs-built_in">self</span>.lo)/(<span class="hljs-built_in">self</span>.hi-<span class="hljs-built_in">self</span>.lo) <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Num:heaven</span><span class="hljs-params">(x,   heaven)</span></span>
  <span class="hljs-keyword">return</span> ((<span class="hljs-built_in">self</span>.w&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>) - <span class="hljs-built_in">self</span>:norm(x))^the.p <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <hr>
<p>[__   _/  |/| 
___]   |   |  | </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">local</span> Sym=obj{}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sym:new</span><span class="hljs-params">(at,x,inc,   new)</span></span> 
  new=as(col(at,x),<span class="hljs-built_in">self</span>); new.most=<span class="hljs-number">0</span>; <span class="hljs-keyword">return</span> new <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sym:add1</span><span class="hljs-params">(x,inc)</span></span>
  i.has[x] = inc + (i.has[x] <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>) 
  <span class="hljs-keyword">if</span> i.has[x] &gt; i.most <span class="hljs-keyword">then</span> i.most,i.mode=i.has[x],x <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <hr>
<p>|    |  | |    [__<br>|___ |<strong>| |</strong>_ ___] </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">local</span> Cols=obj{}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Cols:new</span><span class="hljs-params">(headers,   new,col,here)</span></span>
  new = as({all={}, x={}, y={}},<span class="hljs-built_in">self</span>)
  <span class="hljs-keyword">for</span> at,x <span class="hljs-keyword">in</span> pair(headers) <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> x:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;:$&quot;</span> <span class="hljs-keyword">then</span> new.all[n] = Skip(at,x) <span class="hljs-keyword">else</span>
      col = (x:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;^[A-Z]&quot;</span> <span class="hljs-keyword">and</span> Num <span class="hljs-keyword">or</span> Sym)(at,x)
      <span class="hljs-built_in">self</span>.all[at] = col 
      here =  x:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;[+-]$&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">self</span>.y <span class="hljs-keyword">or</span> <span class="hljs-built_in">self</span>.x
      here[<span class="hljs-number">1</span>+#here] = new <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> new <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Cols:add</span><span class="hljs-params">(t)</span></span>
  <span class="hljs-keyword">for</span> _,col <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(<span class="hljs-built_in">self</span>.all) <span class="hljs-keyword">do</span> col:add(t[col.at]) <span class="hljs-keyword">end</span> 
  <span class="hljs-keyword">return</span> t <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Cols:clone</span><span class="hljs-params">(rows,   new)</span></span>
  new = new <span class="hljs-keyword">or</span> Cols(map(<span class="hljs-built_in">self</span>.cols.all, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span></span> <span class="hljs-keyword">return</span> x.txt <span class="hljs-keyword">end</span>))
  <span class="hljs-keyword">for</span> _,row <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(rows <span class="hljs-keyword">or</span> {}) <span class="hljs-keyword">do</span> new:add(row) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> {rows=rows,cols=new} <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <hr>
<p>|  \ |<strong>|  |  |</strong>| 
|__/ |  |  |  |  | </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">local</span> Data=obj{}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Data:new</span><span class="hljs-params">(inits,  new)</span></span>
  new = as({rows={},heavens=Num()},<span class="hljs-built_in">self</span>)
  <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(inits)==<span class="hljs-string">&quot;string&quot;</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">for</span>   row <span class="hljs-keyword">in</span> csv(inits)   <span class="hljs-keyword">do</span> new:add(row) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> 
  <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(inits)==<span class="hljs-string">&quot;table&quot;</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">for</span> _,row <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(inits) <span class="hljs-keyword">do</span> new:add(row) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> 
  <span class="hljs-keyword">return</span> new <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Data:add</span><span class="hljs-params">(t, n)</span></span>
  <span class="hljs-keyword">if</span> <span class="hljs-built_in">self</span>.cols <span class="hljs-keyword">then</span> <span class="hljs-built_in">self</span>:addData(t) <span class="hljs-keyword">else</span> 
     <span class="hljs-built_in">self</span>.cols = Cols(t) 
     <span class="hljs-built_in">self</span>.best = <span class="hljs-built_in">self</span>.cols:clone()
     <span class="hljs-built_in">self</span>.rest = <span class="hljs-built_in">self</span>.cols:clone() <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Data:addData</span><span class="hljs-params">(t,   n)</span></span>
  <span class="hljs-built_in">self</span>.rows[<span class="hljs-number">1</span>+#<span class="hljs-built_in">self</span>.rows] = <span class="hljs-built_in">self</span>.cols:add(t) 
  n = <span class="hljs-built_in">self</span>.heavens.norm( <span class="hljs-built_in">self</span>.heavens.add(<span class="hljs-built_in">self</span>.heaven(t))) 
  (n&gt;=the.best <span class="hljs-keyword">and</span> <span class="hljs-built_in">self</span>.best <span class="hljs-keyword">or</span> <span class="hljs-built_in">self</span>.rest):add(t) <span class="hljs-keyword">end</span> 

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Data:heaven</span><span class="hljs-params">(t)</span></span>
  heaven = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(col)</span></span> <span class="hljs-keyword">return</span> col:heaven(t[col.at]) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> (sum(<span class="hljs-built_in">self</span>.cols.y,heaven)/#<span class="hljs-built_in">self</span>.cols.y)^(<span class="hljs-number">1</span>/the.p) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <pre><code> _                              
</code></pre>
<p>  <strong>| |  ___  _ __ ___    ___   ___ 
 / <em><code>| / _ \| &#39;_</code> _ \  / _ \ / _<em>|
| (</em>| ||  _<em>/| | | | | || (</em>) |__ <br> __,</em>| _<strong>||<em>| |</em>| |_| _</strong>/ |_</strong>/</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> Demos = {fails=<span class="hljs-number">0</span>}

<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asserts</span><span class="hljs-params">(test, msg)</span></span>
  <span class="hljs-built_in">print</span>(test <span class="hljs-keyword">and</span> <span class="hljs-string">&quot;PASS: &quot;</span><span class="hljs-keyword">or</span> <span class="hljs-string">&quot;FAIL: &quot;</span>,msg <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>) 
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> test <span class="hljs-keyword">then</span> 
    Demos.fails = Demos.fails+<span class="hljs-number">1</span> 
    <span class="hljs-keyword">if</span> the.Dump <span class="hljs-keyword">then</span> <span class="hljs-built_in">assert</span>(test,msg) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Demos.the</span><span class="hljs-params">()</span></span> oo(the) <span class="hljs-keyword">end</span>

the = cli(help)
main(the, help, Demos)</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
